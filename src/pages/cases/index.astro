---
import BaseLayout from '../../layouts/BaseLayout.astro';
import ContentCard from '../../components/ContentCard.astro';
import { getCollection } from 'astro:content';

const allCases = await getCollection('cases');
const sortedCases = allCases.sort((a, b) => b.data.year - a.data.year);
const featuredCases = sortedCases.filter(c => c.data.featured);

const casesByType = {
  'Software': sortedCases.filter(c => c.data.projectType === 'Software'),
  'Branding': sortedCases.filter(c => c.data.projectType === 'Branding'),
  'Audiovisual': sortedCases.filter(c => c.data.projectType === 'Audiovisual'),
  'Consulting': sortedCases.filter(c => c.data.projectType === 'Consulting'),
  'Startups': sortedCases.filter(c => c.data.projectType === 'Startups'),
  'Events': sortedCases.filter(c => c.data.projectType === 'Events'),
};
---

<BaseLayout
  title="Case Studies - WorkalÃ³gico Growth Spiral"
  description="Explore how we've transformed organizations through the Fibonacci Growth methodology"
>
  <div class="min-h-screen bg-spiral-dark">
    <!-- Header -->
    <header class="border-b border-gray-800 bg-spiral-dark/95 backdrop-blur-sm sticky top-0 z-10">
      <div class="container mx-auto px-4 py-6">
        <h1 class="text-3xl font-bold text-spiral-light mb-2">
          Case Studies
        </h1>
        <p class="text-gray-400">
          Growth stories organized by project type
        </p>
        <div class="flex gap-4 mt-4">
          <a
            href="/"
            class="inline-block px-4 py-2 bg-spiral-accent text-white rounded hover:bg-spiral-accent/80 transition-colors"
          >
            â† Spiral Experience
          </a>
          <a
            href="/linear"
            class="inline-block px-4 py-2 bg-spiral-dark border border-gray-700 text-spiral-light rounded hover:border-spiral-accent transition-colors"
          >
            Linear Navigation
          </a>
        </div>
      </div>
    </header>

    <!-- Content -->
    <main class="container mx-auto px-4 py-12">
      <div class="max-w-6xl mx-auto">
        <div class="mb-12">
          <h2 class="text-2xl font-bold text-spiral-light mb-4">
            Historias de Crecimiento Exponencial
          </h2>
          <p class="text-gray-400 leading-relaxed">
            Cada proyecto es un viaje a travÃ©s de la espiral de Fibonacci, donde cada fase amplifica el valor por Ï† (1.618). 
            Casos reales con ROI medible y resultados verificables.
          </p>
        </div>

        {featuredCases.length > 0 && (
          <section class="mb-16">
            <h3 class="text-xl font-bold text-spiral-light mb-6 flex items-center gap-2">
              <span class="text-spiral-accent">â­</span>
              Casos Destacados
            </h3>
            <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
              {featuredCases.map((caseStudy) => (
                <ContentCard
                  title={caseStudy.data.title}
                  description={caseStudy.data.description}
                  href={`/cases/${caseStudy.slug}`}
                  tags={caseStudy.data.tags}
                  phaseId={caseStudy.data.phaseId}
                  meta={`${caseStudy.data.client} Â· ${caseStudy.data.year}`}
                  featured={true}
                />
              ))}
            </div>
          </section>
        )}

        {Object.entries(casesByType).map(([type, cases]) => cases.length > 0 && (
          <section class="mb-12">
            <h3 class="text-xl font-bold text-spiral-light mb-6">
              {type === 'Software' && 'ğŸ’»'} 
              {type === 'Branding' && 'ğŸ¨'} 
              {type === 'Audiovisual' && 'ğŸ¬'} 
              {type === 'Consulting' && 'ğŸ“Š'} 
              {type === 'Startups' && 'ğŸš€'} 
              {type === 'Events' && 'ğŸª'}
              {' '}{type}
              <span class="text-sm text-gray-500 ml-2">({cases.length})</span>
            </h3>
            <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
              {cases.map((caseStudy) => (
                <ContentCard
                  title={caseStudy.data.title}
                  description={caseStudy.data.description}
                  href={`/cases/${caseStudy.slug}`}
                  tags={caseStudy.data.tags}
                  phaseId={caseStudy.data.phaseId}
                  meta={`${caseStudy.data.client} Â· ${caseStudy.data.year}`}
                  featured={false}
                />
              ))}
            </div>
          </section>
        ))}

        <!-- CTA Section -->
        <div class="mt-16 text-center border-t border-gray-800 pt-12">
          <h3 class="text-2xl font-bold text-spiral-light mb-4">
            Â¿Listo para tu historia de crecimiento?
          </h3>
          <p class="text-gray-400 mb-6">
            Exploremos cÃ³mo la metodologÃ­a Fibonacci puede transformar tu proyecto en crecimiento exponencial.
          </p>
          <button
            onclick="window.spiralModal?.show()"
            class="px-8 py-3 bg-spiral-accent text-white rounded-lg font-medium hover:bg-spiral-accent/80 transition-colors focus:outline-none focus:ring-2 focus:ring-spiral-accent focus:ring-offset-2 focus:ring-offset-spiral-dark"
          >
            Iniciar ConversaciÃ³n
          </button>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="border-t border-gray-800 mt-16 py-8">
      <div class="container mx-auto px-4 text-center text-gray-400">
        <p>Â© 2024 WorkalÃ³gico. Built with Astro & the Golden Ratio.</p>
      </div>
    </footer>
  </div>
</BaseLayout>

